// assets/js/printTable.js
function printTable() {
  const table = document.getElementById("searchTable");
  if (!table) return;

  const newWin = window.open("", "_blank");

  newWin.document.write(`
    <html>
    <head>
      <title>Employee Records</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
      <style>
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px; }
        th { background-color: #0d6efd; color: #fff; }

        .print-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        .logo { height: 100px; width: auto; }
        .header-text { text-align: center; flex: 1; }

        .print-footer { text-align: center; margin-top: 30px; font-size: 12px; color: #777; }

        @media print {
          body { -webkit-print-color-adjust: exact; }
        }
      </style>
    </head>
    <body>

      <div class="print-header">
        <img src="${window.location.origin}/assets/images/bagong_pilipinas.png" class="logo">

        <div class="header-text">
          <p>Republic of the Philippines</p>
          <p>Province of Pangasinan</p>
          <h1>MUNICIPALITY OF BOLINAO</h1>
          <p>Date: ${new Date().toLocaleDateString()}</p>
        </div>

        <img src="${window.location.origin}/assets/images/bolinao_logo.png" class="logo">
      </div>

      <hr style="border-top:1px solid #3e3e3e; margin-bottom:20px;">
  `);

  newWin.document.write(table.outerHTML);

  newWin.document.write(`
      <div class="print-footer">
        <p>Generated by Municipality of Bolinao</p>
      </div>
    </body>
    </html>
  `);

  newWin.document.close();

  // âœ… WAIT FOR IMAGES BEFORE PRINTING
  newWin.onload = () => {
    const images = newWin.document.images;
    let loaded = 0;

    if (images.length === 0) {
      newWin.print();
      return;
    }

    for (let img of images) {
      if (img.complete) {
        loaded++;
      } else {
        img.onload = img.onerror = () => {
          loaded++;
          if (loaded === images.length) {
            newWin.print();
          }
        };
      }
    }

    if (loaded === images.length) {
      newWin.print();
    }
  };
}
