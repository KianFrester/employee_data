document.addEventListener("DOMContentLoaded", function () {
  const printBtn = document.getElementById("printEligibilityTable");
  const table = document.getElementById("eligibilityTable");

  if (!printBtn || !table) return;

  printBtn.addEventListener("click", () => {
    const newWin = window.open("", "_blank");

    // Get only visible rows
    const visibleRows = Array.from(table.tBodies[0].rows).filter(
      (row) => row.style.display !== "none",
    );

    // Build table HTML
    let tableHTML = `
      <table class="table table-bordered text-center" style="width:100%; border-collapse: collapse;">
        <thead style="background-color: #16166c; color: #fff;">
          ${table.tHead.innerHTML}
        </thead>
        <tbody>
          ${visibleRows.map((row) => row.outerHTML).join("")}
        </tbody>
      </table>
    `;

    newWin.document.write(`
      <html>
      <head>
        <title>Eligibility Records</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
        <style>
          table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
          th, td { border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px; }
          th { background-color: #16166c; color: #fff; }

          .print-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
          .print-header .logo { height: 80px; width: auto; }
          .print-header .header-text { text-align: center; flex: 1; }
          .print-header .header-text h1 { margin: 0; font-size: 24px; }
          .print-header .header-text p { margin: 0; font-size: 14px; color: #555; }
          .print-footer { text-align: center; margin-top: 30px; font-size: 12px; color: #777; }

          @media print {
            body { -webkit-print-color-adjust: exact; }
            .page-break { page-break-after: always; }
          }
        </style>
      </head>
      <body>
        <div class="print-header">
          <img src="assets/images/bagong_pilipinas.png" alt="Logo" class="logo">
          <div class="header-text">
            <p>Republic of the Philippines</p>
            <p>Province of Pangasinan</p>
            <h1>MUNICIPALITY OF BOLINAO</h1>
            <p>Date: ${new Date().toLocaleDateString()}</p>
          </div>
          <img src="assets/images/bolinao_logo.png" alt="Logo" class="logo">
        </div>
        <hr style="border-top: 1px solid #3e3e3e; margin-bottom: 20px;">
        ${tableHTML}
        <div class="print-footer">
          <p>Generated by Municipality of Bolinao</p>
        </div>
      </body>
      </html>
    `);

    newWin.document.close();
    newWin.print();
  });
});
